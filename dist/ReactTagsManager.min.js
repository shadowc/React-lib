!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=18)}([function(t,e){t.exports=React},function(t,e){t.exports=jQuery},function(t,e){t.exports=ReactDOM},function(t,e){t.exports=PropTypes},,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),i=r(n(1)),a=r(n(0)),u=r(n(3));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={tags:[],suggestions:[]},n.input=null,n.body=document.getElementsByTagName("body")[0],n.hiddenTags=n.props.hiddenFieldsContainer.children,n.newTagIndex=n.hiddenTags.length/2,n.suggestionTimeout=null,n.prevInputValue="",(0,i.default)(document).on("click",n.clearSuggestions.bind(n)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default.Component),s(e,[{key:"render",value:function(){var t=this;return a.default.createElement("div",{className:"tag-list",onClick:this.handleFocus.bind(this)},this.state.tags.map(this.renderTag.bind(this)),a.default.createElement("input",{ref:function(e){t.input=e},type:"text",className:"transparent",id:this.props.tagsTextLabel?this.props.tagsTextLabel:"tags",name:this.props.tagsTextLabel?this.props.tagsTextLabel:"tags",onKeyPress:this.onKeyPress.bind(this),onKeyUp:this.onKeyUp.bind(this)}),this.state.suggestions.length?a.default.createElement("div",{className:"tag_suggestions"},this.state.suggestions.map(this.renderSuggestion.bind(this))):"")}},{key:"renderTag",value:function(t){return a.default.createElement("span",{key:t.text},t.text," ",a.default.createElement("a",{href:"#",onClick:this.removeTag.bind(this,t)},"x"))}},{key:"renderSuggestion",value:function(t){var e=new RegExp("^(.*)("+this.input.value+")(.*)$","i"),n=t.text.match(e),s=t.text;if(null!==n&&4===n.length){var i=n[1],u=n[2],r=n[3];s=a.default.createElement("span",null,i,a.default.createElement("strong",null,u),r)}else s=a.default.createElement("span",null,t.text);return a.default.createElement("a",{href:"#",key:t.text,onClick:this.onSuggestionClick.bind(this,t)},s)}},{key:"addTag",value:function(t){if((t=t.trim()).endsWith(",")&&(t=t.substr(0,t.length-1)),""!==t){for(var e=0;e<this.state.tags.length;e++)if(this.state.tags[e].text===t)return void this.setState({suggestions:[]});for(var n=0,s=0;s<this.state.suggestions.length;s++){var a=this.state.suggestions[s];if(a.text.toLowerCase()===t.toLowerCase()){n=a.id,t=a.text;break}}var u=this.props.hiddenFieldsContainer.getAttribute("data-prototype").replace(/__name__/g,this.newTagIndex.toString(10));this.newTagIndex+=1,(0,i.default)(this.props.hiddenFieldsContainer).append(u),this.hiddenTags[this.hiddenTags.length-2].value=n,this.hiddenTags[this.hiddenTags.length-1].value=t;var r=this.hiddenTags[this.hiddenTags.length-2].id+"|"+this.hiddenTags[this.hiddenTags.length-1].id;this.state.tags.push({id:null,tagId:r,text:t}),this.setState({tags:this.state.tags,suggestions:[]}),this.input.focus()}else this.setState({suggestions:[]})}},{key:"removeTag",value:function(t,e){e&&e.preventDefault(),t.tagId.split("|").forEach(function(t){var e=document.getElementById(t);e.parentNode.removeChild(e)});for(var n=0;n<this.state.tags.length;n++){if(this.state.tags[n].text===t.text){this.state.tags.splice(n,1);break}}this.setState({tags:this.state.tags})}},{key:"resetSuggestionsTimeout",value:function(){null!==this.suggestionTimeout&&(clearTimeout(this.suggestionTimeout),this.suggestionTimeout=null)}},{key:"updateSuggestions",value:function(){var t=this;""!==this.input.value?(this.resetSuggestionsTimeout(),this.suggestionTimeout=setTimeout(function(){var e=t.props.xhrRouteCallback(t.input.value);i.default.ajax(e,{method:"GET"}).then(function(e){var n=JSON.parse(e);"function"==typeof n.map&&t.setState({suggestions:n})})},200)):(this.resetSuggestionsTimeout(),this.setState({suggestions:[]}))}},{key:"onKeyUp",value:function(t){"Backspace"===t.key&&""===this.prevInputValue&&this.state.tags.length&&(this.state.tags.splice(this.state.tags.length-1,1),this.setState({tags:this.state.tags}));var e=document.createElement("span");e.style.fontSize="16px",e.innerHTML=this.input.value.replace(/\s/g,"&nbsp;"),this.body.appendChild(e),this.input.style.width=e.offsetWidth+"px",this.body.removeChild(e),this.prevInputValue=this.input.value,this.updateSuggestions()}},{key:"onKeyPress",value:function(t){switch(t.key){case",":case"Enter":this.addTag(this.input.value),this.input.value="",this.prevInputValue="",this.input.style.width="5px",t.preventDefault()}}},{key:"handleFocus",value:function(t){t.preventDefault(),this.input.focus(),this.updateSuggestions()}},{key:"onSuggestionClick",value:function(t,e){e.preventDefault(),e.stopPropagation(),this.addTag(t.text),this.input.value="",this.prevInputValue=""}},{key:"clearSuggestions",value:function(t){for(var e=t.target;null!==e;){if("tag_suggestions"===e.className)return;e=e.parentNode}this.setState({suggestions:[]})}}]),e}();e.default=o,o.propTypes={hiddenFieldsContainer:u.default.instanceOf(HTMLElement).isRequired,tagsTextLabel:u.default.string,xhrRouteCallback:u.default.func.isRequired},o.defaultProps={tagsTextLabel:"text"}},,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],s=!0,i=!1,a=void 0;try{for(var u,r=t[Symbol.iterator]();!(s=(u=r.next()).done)&&(n.push(u.value),!e||n.length!==e);s=!0);}catch(t){i=!0,a=t}finally{try{!s&&r.return&&r.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=o(n(1)),a=o(n(0)),u=o(n(2)),r=o(n(7));function o(t){return t&&t.__esModule?t:{default:t}}e.default=function t(e,n,o,l,d){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var h=[],g=i.default.find("input[type=hidden]"),c=0,p={};(0,i.default)(g).each(function(t,e){var n=new RegExp("^"+o+"\\_(\\d+)\\_(id|text)$"),i=e.id.match(n),a=s(i,3),u=a[0],r=a[1],l=a[2];Number(r)!==c&&(h.push(p),c=Number(r),p={}),p.tagId=p.tagId?p.tagId+"|"+u:u,p[l]=e.value}),p.id&&p.text&&h.push(p),this.tagsDisplay=u.default.render(a.default.createElement(r.default,{hiddenFieldsContainer:e,tagsTextLabel:l,xhrRouteCallback:d}),n),this.tagsDisplay.setState({tags:h})}},,,,,function(t,e,n){"use strict";var s=a(n(13)),i=a(n(7));function a(t){return t&&t.__esModule?t:{default:t}}void 0===window.ReactLib&&(window.ReactLib={}),window.ReactLib.ReactTagsDisplay=i.default,window.ReactLib.TagsManager=s.default}]);